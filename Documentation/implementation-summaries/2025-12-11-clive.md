# Review Report — 2025-12-11

## Scope & Acceptance Criteria
- Add a reproducible Windows `.exe` build for Diff-Utility using PyInstaller.
- Automate releases with two GitHub Actions workflows:
  - `latest-release`: on push to `main`, build, test, and publish the newest executable under a stable "latest-release" label.
  - `version-release`: manually triggered workflow that builds/tests and publishes an executable under a versioned tag `version-[semver]`.
- Ensure workflows satisfy repository quality gates (Black, Ruff, mypy strict, pytest ≥80% line / ≥75% branch coverage) per `Documentation/CODING_STANDARDS.md` §2–§4.

## Diffs Reviewed
1. `.github/workflows/release-latest.yml`: new CI job for automatic latest releases.
2. `.github/workflows/release-version.yml`: manual dispatch workflow for tagged releases.
3. `build_exe.py`: PyInstaller wrapper script to generate `dist/diff-utility.exe`.
4. `VERSION.txt`: new file storing the canonical semantic version string.
5. `pyproject.toml`: bump to `1.0.0` and add `pyinstaller` to the development dependency group.

## Tests / Tooling Observed
- `python -m black --check .`
- `python -m ruff check .`
- `python -m mypy --strict .`
- `python -m pytest --cov=src --cov-branch --cov-fail-under=80 -q`
- `python scripts/check_branch_coverage.py --threshold 75`
- Manual execution of `build_exe.py` and `dist/diff-utility.exe --help`

All tests passed with 93.86% line coverage / 96.15% branch coverage.

## Findings
1. **Blocking – Missing step id breaks asset upload** (`.github/workflows/release-latest.yml` lines 33-52; `.github/workflows/release-version.yml` lines 37-56)
   - The upload step references `${{ steps.create_release.outputs.upload_url }}` but the preceding "Create release" step never assigns `id: create_release`. GitHub Actions will fail to evaluate this expression ("The workflow is not valid. The step id 'create_release' does not exist") and the asset will never be attached.
   - **Fix:** add `id: create_release` to both "Create release" steps or switch to `gh release upload` with explicit upload URL handling.

2. **Blocking – `latest-release` tag reuse causes workflow failure on second run** (`.github/workflows/release-latest.yml` lines 25-44)
   - `actions/create-release@v1` will error when asked to create a release for an existing tag. Because this workflow always uses the constant tag `latest-release`, the very next push to `main` will fail with `Validation Failed: Tag already exists`. Requirements call for keeping a stable "latest release" label, so the workflow must delete/recreate the tag or move it via the GitHub API before calling `create-release`.
   - **Fix:** either delete the prior release/tag (using the REST API or `gh release delete` + `git push --delete origin latest-release`) or use an action that supports overwriting (e.g., `softprops/action-gh-release` with `tag_name` plus `make_latest`).

## Revision Follow-up (2025-12-11 PM)
- Claudette replaced the deprecated `actions/create-release@v1` / `upload-release-asset@v1` pair with `softprops/action-gh-release@v1`, which combines release creation and asset upload and safely updates an existing `latest-release` tag.
- Both workflows now upload `dist/diff-utility.exe` directly via the action’s `files` input, eliminating the missing-step-id issue.
- Quality gates rerun and pass: Black, Ruff, mypy --strict, pytest w/ 93.86% line and 96.15% branch coverage, plus branch-threshold script.

## Verdict
All blockers resolved; implementation now meets the scope and coding standards. **Green-light for integration.**
